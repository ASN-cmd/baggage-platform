generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Client {
  id        Int       @id @default(autoincrement())
  name      String
  email     String?
  projects  Project[]
  createdAt DateTime  @default(now())
}

model Project {
  id        Int       @id @default(autoincrement())
  clientId  Int
  name      String
  location  String?
  cameras   Camera[]
  createdAt DateTime  @default(now())

  client    Client @relation(fields: [clientId], references: [id])
}

model Camera {
  id        Int       @id @default(autoincrement())
  projectId Int
  cameraName String
  rtspUrl    String?
  fps       Int?
  resolutionWidth  Int?
  resolutionHeight Int?
  zones     Zone[]
  videos    Video[]
  createdAt DateTime @default(now())

  project  Project @relation(fields: [projectId], references: [id])
}

model Zone {
  id        Int      @id @default(autoincrement())
  cameraId  Int
  zoneName  String
  coordinates Json
  createdAt DateTime @default(now())

  camera   Camera @relation(fields: [cameraId], references: [id])
}

model Video {
  id        Int      @id @default(autoincrement())
  cameraId  Int
  filePath  String
  durationSeconds Int?
  sampledFrames SampledFrame[]
  createdAt DateTime @default(now())

  camera   Camera @relation(fields: [cameraId], references: [id])
}

model SampledFrame {
  id          Int      @id @default(autoincrement())
  videoId     Int
  frameNumber Int
  imagePath   String
  motionScore Float?
  densityScore Float?
  brightnessScore Float?
  finalScore  Float?
  autoAnnotations AutoAnnotation[]
  createdAt   DateTime @default(now())

  video Video @relation(fields: [videoId], references: [id])
}

model AutoAnnotation {
  id             Int      @id @default(autoincrement())
  sampledFrameId Int
  className      String
  confidence     Float
  bbox           Json
  createdAt      DateTime @default(now())

  frame SampledFrame @relation(fields: [sampledFrameId], references: [id])
}
